#!/bin/bash

# Check if the script is run with sudo
if [ "$EUID" -eq 0 ]; then
  echo "Please do not run this script with sudo."
  exit 1
fi

# Function to check if python3 is installed
check_python_version() {
  if command -v python3 &>/dev/null; then
    PYTHON_VERSION=$(python3 -V 2>&1 | cut -d " " -f 2)
    echo "Python 3 is installed. Version: $PYTHON_VERSION"
  else
    echo "Python 3 is not installed. Installing Python 3.10..."
    sudo apt update && sudo apt -y install python3.10
    PYTHON_VERSION="3.10"
  fi
}

# Function to install the equivalent venv package
install_venv() {
  case $PYTHON_VERSION in
    3.6*) sudo apt -y install python3.6-venv ;;
    3.7*) sudo apt -y install python3.7-venv ;;
    3.8*) sudo apt -y install python3.8-venv ;;
    3.9*) sudo apt -y install python3.9-venv ;;
    3.10*) sudo apt -y install python3.10-venv ;;
    *)
      echo "Unsupported Python version."
      exit 1
      ;;
  esac
}

# Check Python version
check_python_version

# Install the corresponding venv package
install_venv

# Install pipx and impacket
python3 -m pip install --user pipx
python3 -m pipx install impacket
pipx ensurepath

echo "Impacket installation is complete."
